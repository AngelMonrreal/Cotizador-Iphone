<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<title>MONMEX</title>
<meta name="apple-mobile-web-app-title" content="MONMEX">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<link rel="apple-touch-icon" href="logoinicio.jpeg">
<link rel="icon" href="logoinicio.jpeg">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#fff;
  padding:20px;
  display:flex;
  justify-content:center;
}
.app{max-width:420px;width:100%}
select,input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid #cbd5e1;
}
button{background:#0f172a;color:#fff}
button.eliminar{background:#dc2626}
.tabs{display:flex;gap:10px;margin-top:14px}
.panel{
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:16px;
  margin-top:14px;
}
.hidden{display:none}
.precio{text-align:center;font-size:34px;font-weight:700}
.label{text-align:center;color:#475569}
.row{display:flex;justify-content:space-between;margin-top:10px}
.ganancia{
  color:#16a34a;
  font-weight:600;
  border-top:1px solid #e5e7eb;
  padding-top:10px;
  margin-top:12px
}
.small{text-align:center;font-size:12px;color:#64748b}

/* ADMIN MODELOS COMPACTO */
.model-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  padding:8px 10px;
  border:1px solid #e5e7eb;
  border-radius:10px;
  margin-top:6px;
  font-size:13px;
}
.model-info{
  line-height:1.2;
}
.model-actions{
  display:flex;
  gap:6px;
}
.model-actions button{
  padding:6px 10px;
  font-size:12px;
  border-radius:8px;
}
</style>
</head>

<body>
<div class="app">

<!-- LOGO -->
<div style="text-align:center;margin-bottom:6px">
  <img src="logomonmex.png.jpeg" style="width:200px;border-radius:20px">
  <div class="small">Compra y venta de electrónica</div>
</div>

<select id="modelo" onchange="calcular()"></select>

<select id="gb" onchange="calcular()">
  <option value="">Capacidad</option>
  <option value="64">64 GB</option>
  <option value="128">128 GB</option>
  <option value="256">256 GB</option>
  <option value="512">512 GB</option>
  <option value="1024">1 TB</option>
  <option value="2048">2 TB</option>
</select>

<div class="tabs">
  <button onclick="mostrarCliente()">Cliente</button>
  <button onclick="pedirPin()">Administrador</button>
</div>

<!-- CLIENTE -->
<div class="panel" id="clientePanel">
  <div class="label">Costo Evaluado</div>
  <div class="precio" id="precioCompraCliente">—</div>
</div>

<!-- LOGIN -->
<div class="panel hidden" id="loginPanel">
  <input type="password" id="pinInput" placeholder="PIN">
  <button onclick="validarPin()">Entrar</button>
</div>

<!-- ADMIN -->
<div class="panel hidden" id="adminPanel">

  <div class="row"><span>Compra</span><span id="precioCompraAdmin">—</span></div>
  <div class="row"><span>Venta</span><span id="precioVentaAdmin">—</span></div>
  <div class="row ganancia"><span>Ganancia</span><span id="ganancia">—</span></div>

  <hr>

  <input id="newModelo" placeholder="Modelo (i17, i17p, i17pm)">
  <input id="newGB" placeholder="GB">
  <input id="newCompra" placeholder="Precio compra">
  <input id="newVenta" placeholder="Precio venta">

  <button onclick="guardarModelo()">Guardar / Actualizar</button>
  <button onclick="abrirAdminModelos()">Administrar modelos</button>

  <div class="small">p = Pro · pm = Pro Max</div>
</div>

<!-- ADMIN MODELOS -->
<div class="panel hidden" id="panelModelos"></div>

</div>

<script>
const PIN="2303";

let precios=JSON.parse(localStorage.getItem("precios"))||{
  "i13-128":[8500,9800],
  "i13p-256":[12500,14500],
  "i13pm-256":[13500,15800]
};

function nombreBonito(m){
  let num=m.replace(/\D/g,"");
  if(m.endsWith("pm")) return num+" Pro Max";
  if(m.endsWith("p")) return num+" Pro";
  return num;
}

function cargarModelos(){
  modelo.innerHTML='<option value="">Modelo</option>';
  [...new Set(Object.keys(precios).map(k=>k.split("-")[0]))].forEach(m=>{
    let o=document.createElement("option");
    o.value=m;
    o.textContent="iPhone "+nombreBonito(m);
    modelo.appendChild(o);
  });
}

function calcular(){
  let k=modelo.value+"-"+gb.value;
  if(precios[k]){
    let [c,v]=precios[k];
    precioCompraCliente.textContent="$"+c;
    precioCompraAdmin.textContent="$"+c;
    precioVentaAdmin.textContent="$"+v;
    ganancia.textContent="$"+(v-c);
  }else{
    precioCompraCliente.textContent="—";
    precioCompraAdmin.textContent="—";
    precioVentaAdmin.textContent="—";
    ganancia.textContent="—";
  }
}

function mostrarCliente(){
  clientePanel.classList.remove("hidden");
  adminPanel.classList.add("hidden");
  loginPanel.classList.add("hidden");
  panelModelos.classList.add("hidden");
}

function pedirPin(){
  clientePanel.classList.add("hidden");
  loginPanel.classList.remove("hidden");
}

function validarPin(){
  if(pinInput.value===PIN){
    loginPanel.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    pinInput.value="";
  }else alert("PIN incorrecto");
}

function guardarModelo(){
  let m=newModelo.value.trim();
  let g=newGB.value.trim();
  let c=parseInt(newCompra.value);
  let v=parseInt(newVenta.value);
  if(!m||!g||!c||!v){alert("Completa todo");return;}
  precios[m+"-"+g]=[c,v];
  localStorage.setItem("precios",JSON.stringify(precios));
  cargarModelos();
  newModelo.value=newGB.value=newCompra.value=newVenta.value="";
}

/* TOGGLE ADMIN MODELOS */
function abrirAdminModelos(){

  if(!panelModelos.classList.contains("hidden")){
    panelModelos.classList.add("hidden");
    return;
  }

  panelModelos.innerHTML="";
  panelModelos.classList.remove("hidden");

  Object.keys(precios).forEach(k=>{
    let [m,g]=k.split("-");
    let [c,v]=precios[k];

    panelModelos.innerHTML+=`
      <div class="model-row">
        <div class="model-info">
          <b>iPhone ${nombreBonito(m)}</b> · ${g}GB<br>
          $${c} → $${v}
        </div>
        <div class="model-actions">
          <button onclick="editarModelo('${k}')">Editar</button>
          <button class="eliminar" onclick="eliminarClave('${k}')">X</button>
        </div>
      </div>
    `;
  });
}

function editarModelo(k){
  let [m,g]=k.split("-");
  let [c,v]=precios[k];
  newModelo.value=m;
  newGB.value=g;
  newCompra.value=c;
  newVenta.value=v;
  panelModelos.classList.add("hidden");
}

function eliminarClave(k){
  if(confirm("¿Eliminar modelo?")){
    delete precios[k];
    localStorage.setItem("precios",JSON.stringify(precios));
    abrirAdminModelos();
    cargarModelos();
  }
}

cargarModelos();
</script>

</body>
</html>
